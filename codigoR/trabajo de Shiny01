# Instalar si no tienes shiny
# install.packages("shiny")

library(shiny)

ui <- fluidPage(
  titlePanel("Regresi贸n Lineal - App Interactiva"),
  
  sidebarLayout(
    sidebarPanel(
      h3("Navegaci贸n"),
      selectInput("menu", "Selecciona un apartado:",
                  choices = c("Introducci贸n", 
                              "Simulaci贸n", 
                              "Tama帽o de Muestra",
                              "Interpretaci贸n",
                              "Recursos")),
      hr(),
      conditionalPanel(
        condition = "input.menu == 'Simulaci贸n'",
        numericInput("n", "N煤mero de observaciones:", 50, min = 10, max = 500),
        sliderInput("beta0", "Intercepto (尾0):", -5, 5, 2),
        sliderInput("beta1", "Pendiente (尾1):", -5, 5, 1),
        sliderInput("sigma", "Desviaci贸n est谩ndar del error:", 0.1, 5, 1, step = 0.1),
        actionButton("go", "Generar datos")
      ),
      conditionalPanel(
        condition = "input.menu == 'Tama帽o de Muestra'",
        sliderInput("nsize", "Tama帽o de muestra:", 30, 500, 50),
        numericInput("beta1_true", "Valor verdadero de 尾1:", 1, -5, 5),
        actionButton("calc", "Calcular Estimaciones")
      )
    ),
    
    mainPanel(
      uiOutput("contenido")
    )
  )
)

server <- function(input, output, session) {
  
  # --- CONTENIDOS ---
  output$contenido <- renderUI({
    if (input$menu == "Introducci贸n") {
      tagList(
        h2(" Introducci贸n a la Regresi贸n Lineal"),
        p("La regresi贸n lineal es un m茅todo estad铆stico que busca modelar la relaci贸n entre una variable dependiente (Y) y una o m谩s variables independientes (X)."),
        withMathJax("Modelo simple: $$ Y_i = \\beta_0 + \\beta_1 X_i + \\varepsilon_i $$"),
        p("Donde:"),
        tags$ul(
          tags$li("尾0: Intercepto"),
          tags$li("尾1: Pendiente (efecto de X sobre Y)"),
          tags$li("蔚: Error aleatorio, asumido normal con media 0 y varianza 虏")
        )
      )
    }
    else if (input$menu == "Simulaci贸n") {
      tagList(
        h2(" Simulaci贸n de Regresi贸n"),
        plotOutput("scatter"),
        verbatimTextOutput("modelo")
      )
    }
    else if (input$menu == "Tama帽o de Muestra") {
      tagList(
        h2(" Estudio del Tama帽o de Muestra"),
        plotOutput("histBeta1"),
        p("A mayor tama帽o de muestra, menor varianza en la estimaci贸n de los par谩metros.")
      )
    }
    else if (input$menu == "Interpretaci贸n") {
      tagList(
        h2(" Redacci贸n e Interpretaci贸n"),
        p("Ejemplo: Si 尾1 = 2.5, significa que por cada aumento de 1 unidad en X, la variable dependiente Y aumenta en promedio 2.5 unidades."),
        p("La significancia estad铆stica se eval煤a mediante la prueba t y el valor-p.")
      )
    }
    else if (input$menu == "Recursos") {
      tagList(
        h2(" Recursos Adicionales"),
        tags$ul(
          tags$li(a("Regresi贸n Lineal - Wikipedia", href="https://es.wikipedia.org/wiki/Regresi%C3%B3n_lineal", target="_blank")),
          tags$li(a("Libro: Introducci贸n a la Econometr铆a - Wooldridge", href="https://www.wooldridge.com", target="_blank")),
          tags$li("Curso de R y Shiny en CRAN")
        )
      )
    }
  })
  
  # --- SIMULACIN ---
  datos <- eventReactive(input$go, {
    set.seed(123)
    x <- rnorm(input$n, 0, 1)
    y <- input$beta0 + input$beta1 * x + rnorm(input$n, 0, input$sigma)
    data.frame(x, y)
  })
  
  output$scatter <- renderPlot({
    req(datos())
    plot(datos()$x, datos()$y, main="Simulaci贸n de Regresi贸n Lineal",
         xlab="X", ylab="Y", pch=19, col="blue")
    abline(lm(y ~ x, data = datos()), col="red", lwd=2)
  })
  
  output$modelo <- renderPrint({
    req(datos())
    summary(lm(y ~ x, data = datos()))
  })
  
  # --- TAMAO DE MUESTRA ---
  simulaciones <- eventReactive(input$calc, {
    beta1_est <- replicate(1000, {
      x <- rnorm(input$nsize, 0, 1)
      y <- 2 + input$beta1_true * x + rnorm(input$nsize, 0, 1)
      coef(lm(y ~ x))[2]
    })
    beta1_est
  })
  
  output$histBeta1 <- renderPlot({
    req(simulaciones())
    hist(simulaciones(), col="lightblue", border="white",
         main="Distribuci贸n de las estimaciones de 尾1",
         xlab="Estimaciones de 尾1")
    abline(v = input$beta1_true, col="red", lwd=2)
  })
}

shinyApp(ui, server)
